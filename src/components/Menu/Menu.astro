---
import { navigation } from "@/data/navigation"
import NavList from "./NavList.astro"
import { Icon } from "astro-icon/components"
---

<nav class="hidden md:flex gap-5 items-center">
	<NavList
		navigation={navigation}
		className="text-zinc-700 flex items-center gap-1 transition-colors hover:text-zinc-600"
	/>
</nav>

<!-- MOBILE BUTTON -->
<button
	id="menu-toggle"
	type="button"
	title="–ú–æ–±–∏–ª—å–Ω–æ–µ –º–µ–Ω—é"
	class="md:hidden w-[40px] h-[36px] flex items-center justify-center
	       bg-zinc-800 rounded-lg text-white"
	aria-controls="mobile-menu"
	aria-expanded="false"
>
	<Icon name="mdi:menu-open" class="text-xl" />
	<span class="sr-only">–ú–æ–±–∏–ª—å–Ω–æ–µ –º–µ–Ω—é</span>
</button>

<!-- MOBILE MENU -->
<div
	id="mobile-menu"
	role="dialog"
	aria-modal="true"
	aria-hidden="true"
	class="fixed inset-x-0 top-[75px] z-50 h-[calc(100dvh-75px)]
		bg-black/60 backdrop-blur-2xl
		flex justify-center items-start p-12
		opacity-0 pointer-events-none
		transition-all duration-300 ease-out"
	style="view-transition-name: mobile-menu"
>
	<nav class="flex flex-col gap-6 items-start">
		<NavList
			navigation={navigation}
			className="text-white text-2xl flex items-center gap-1"
		/>
	</nav>
</div>

<script data-astro-exec>
	const toggle = document.getElementById("menu-toggle")
	const menu = document.getElementById("mobile-menu")
	const body = document.body

	const openMenu = () => {
		menu?.setAttribute("data-open", "")
		menu?.setAttribute("aria-hidden", "false")
		toggle?.setAttribute("aria-expanded", "true")
		body.classList.add("overflow-hidden")
	}

	const closeMenu = () => {
		menu?.removeAttribute("data-open")
		menu?.setAttribute("aria-hidden", "true")
		toggle?.setAttribute("aria-expanded", "false")
		body.classList.remove("overflow-hidden")
	}

	toggle?.addEventListener("click", () => {
		const isOpen = menu?.hasAttribute("data-open")
		isOpen ? closeMenu() : openMenu()
	})

	// –ó–∞–∫—Ä—ã—Ç–∏–µ –ø—Ä–∏ –∫–ª–∏–∫–µ –ø–æ —Å—Å—ã–ª–∫–µ
	menu?.addEventListener("click", e => {
		if (e.target.closest("a")) closeMenu()
	})

	// üí° –ö–õ–Æ–ß–ï–í–û–ï: –∑–∞–∫—Ä—ã–≤–∞–µ–º –º–µ–Ω—é –ø—Ä–∏ –Ω–∞–≤–∏–≥–∞—Ü–∏–∏ Astro
	// document.addEventListener("astro:before-preparation", closeMenu)
</script>

<style>
	/* MOBILE MENU STATES */
	#mobile-menu[data-open] {
		opacity: 1;
		pointer-events: auto;
		transform: translateY(0);
	}

	#mobile-menu {
		transform: translateY(-8px);
	}

	/* View Transitions animation */
	@keyframes menu-fade-in {
		from {
			opacity: 0;
			transform: translateY(-12px);
		}
		to {
			opacity: 1;
			transform: translateY(0);
		}
	}

	@keyframes menu-fade-out {
		from {
			opacity: 1;
			transform: translateY(0);
		}
		to {
			opacity: 0;
			transform: translateY(-12px);
		}
	}

	::view-transition-old(mobile-menu) {
		animation: menu-fade-out 150ms ease-in forwards;
	}

	::view-transition-new(mobile-menu) {
		animation: menu-fade-in 250ms ease-out forwards;
	}
</style>
